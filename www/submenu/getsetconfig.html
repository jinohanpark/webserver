
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>IP CAMERA</title>
<link rel="stylesheet" href="/default.css">

<script src="/socket.io/socket.io.js"></script>
<script src="/include/jquery-1.8.2.js"></script>
<script src="/submenu_nav.js"></script>
<script src="configuration.ssi?action=query&lvalue=system.deviceinfo.%&var=gserverform_deviceinfo"></script>

<script>
var gsocket_config;
var gserverform_deviceinfo;

console.log('gnaaaa : ' + gnaaaa);

</script>

<script>

	Init_jQuery();

	$(document).ready( 
		function() {
			;
		}
	);
	
</script>
</head>

<body>
<table class="layout_grid" cellspacing="0" cellpadding="0">
	<tr>
		<td class="left_nav">
			<script>showSubmenu('submenu_nav');</script>
		</td>

		<td class="normal">
			<div class="normal">
				<h3><script>getSubmenuText();</script></h3>
				<p>
					WEB.SOCKET을 통한 서버DB와의 데이터 주고받기.
				</p>
			</div>
			
			<div class="normal">
				<p>
					시스템.디바이스정보
				</p>
				
				<p>
				<br>
				생산자
				</p>
				<input type="text", id="idtext_mfgname" size='39' />
				
				<p>
				<br>
				모델이름
				</p>
				<input type="text", id="idtext_model" size='39' />
				
				<p>
				<input type="button", id="idbutton_apply" value="적용" />
				</p>
			</div>

		</td>
	</tr>
</table>
</body>
</html>

<script>
	showSubmenu_Selected();

	window.onload = function() {
		
		gsocket_config = io.connect();
		init_socket( gsocket_config );
		
		//
		gsocket_config.emit('subscribe_configuration',
							{ href:window.location.href, action:'get', query:'system.deviceinfo.%' });

		//
		document.getElementById('idbutton_apply').onclick = function() {
			var submitform = [];

			var text = document.getElementById('idtext_mfgname').value;
			var json = {lvalue:'system.deviceinfo.manufacturer', rvalue:text};
			submitform.push(json);

			var text = document.getElementById('idtext_model').value;
			var json = {lvalue:'system.deviceinfo.model', rvalue:text};
			submitform.push(json);
			
			gsocket_config.emit('subscribe_configuration',
								{ href:window.location.href, action:'set', query:submitform });
		}
	}

	function init_socket(_socket) {
		_socket.on( 'publish_configuration', function(_data) {
			if( 'done' == _data.action ) {
				console.log('publish_configuration - done');
			}//if( 'done' == _data.action )
			else
			if( 'ready' == _data.action ) {
				console.log('publish_configuration - ready');
			}//if( 'ready' == _data.action )
			else
			if( 'get' == _data.action ) {
				switch( _data.query ) {
				case 'system.deviceinfo.%':
					gserverform_deviceinfo = _data.result;
					document.getElementById('idtext_mfgname').value = gserverform_deviceinfo['system.deviceinfo.manufacturer'][0];
					document.getElementById('idtext_model').value = gserverform_deviceinfo['system.deviceinfo.model'][0];

					/*
					result:
					{ 'system.deviceinfo.manufacturer': [ 'manufacturer', [Object] ],
					  'system.deviceinfo.model': [ 'model', [Object] ],
					  'system.deviceinfo.fwversion': [ 'fwversion', [Object] ],
					  'system.deviceinfo.serialno': [ 'serialno', [Object] ],
					  'system.deviceinfo.hwid': [ 'hwid', [Object] ] } }

					console.log( 'publish_configuration - ', gserverform_deviceinfo['system.deviceinfo.manufacturer'][0] );
					console.log( 'publish_configuration - ', gserverform_deviceinfo['system.deviceinfo.manufacturer'][1] );
					var json = gserverform_deviceinfo['system.deviceinfo.manufacturer'][1];
					console.log( 'publish_configuration - ', json.min );
					console.log( 'publish_configuration - ', json.max );
					console.log( 'publish_configuration - ', json.def );
					console.log( 'publish_configuration - ', json.type );
					*/
					break;
				}
			}//if( 'get' == _data.action )
			else
			if( 'set' == _data.action ) {
				;
			}
		});
	}

</script>
